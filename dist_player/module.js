define(["@grafana/data","react"],(e,t)=>(()=>{"use strict";let r,a,n,o,l={781:t=>{t.exports=e},959:e=>{e.exports=t}},i={};function u(e){let t=i[e];if(void 0!==t){return t.exports;}let r=i[e]={exports:{}};return l[e](r,r.exports,u),r.exports}u.m=l,u.n=e=>{let t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,u.t=function(e,t){if(1&t&&(e=this(e)),8&t){return e;}if("object"===typeof e&&e){if(4&t&&e.__esModule){return e;}if(16&t&&"function"===typeof e.then){return e}}let n=Object.create(null);u.r(n);let o={};r=r||[null,a({}),a([]),a(a)];for(let l=2&t&&e;"object"===typeof l&&!~r.indexOf(l);l=a(l)){Object.getOwnPropertyNames(l).forEach(t=>o[t]=()=>e[t]);}return o.default=()=>e,u.d(n,o),n},u.d=(e,t)=>{for(let r in t){u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}},u.f={},u.e=e=>Promise.all(Object.keys(u.f).reduce((t,r)=>(u.f[r](e,t),t),[])),u.u=e=>e+".js",u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},o="stream-live-panel:",u.l=(e,t,r,a)=>{if(n[e]){n[e].push(t);}else{let l,i;if(void 0!==r){for(let s=document.getElementsByTagName("script"),d=0;d<s.length;d++){let p=s[d];if(p.getAttribute("src")==e||p.getAttribute("data-webpack")==o+r){l=p;break}}}l||(i=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,u.nc&&l.setAttribute("nonce",u.nc),l.setAttribute("data-webpack",o+r),l.src=e),n[e]=[t];var c=(t,r)=>{l.onerror=l.onload=null,clearTimeout(f);let a=n[e];if(delete n[e],l.parentNode&&l.parentNode.removeChild(l),a&&a.forEach(e=>e(r)),t){return t(r)}},f=setTimeout(c.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=c.bind(null,l.onerror),l.onload=c.bind(null,l.onload),i&&document.head.appendChild(l)}},u.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="public/plugins/stream-live-panel/",(()=>{let e={231:0};u.f.j=(t,r)=>{let a=u.o(e,t)?e[t]:void 0;if(0!==a){if(a){r.push(a[2]);}else{let n=new Promise((r,n)=>a=e[t]=[r,n]);r.push(a[2]=n);let o=u.p+u.u(t),l=new Error();u.l(o,r=>{if(u.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){let n=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,a[1](l)}},"chunk-"+t,t)}}};let t=(t,r)=>{let a,n,[o,l,i]=r,s=0;if(o.some(t=>0!==e[t])){for(a in l){u.o(l,a)&&(u.m[a]=l[a]);}i&&i(u)}for(t&&t(r);s<o.length;s++){n=o[s],u.o(e,n)&&e[n]&&e[n][0](),e[n]=0}},r=self.webpackChunkstream_live_panel=self.webpackChunkstream_live_panel||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();let s={};u.r(s),u.d(s,{plugin:()=>f});let d=u(781),p=u(959),c=u.n(p);const f=new d.PanelPlugin(({options:e,data:t,width:r,height:a})=>{const n=(0,p.useRef)(null),o=(0,p.useMemo)(()=>{let r=[];return t&&t.series&&t.series.length>0&&t.series.forEach(e=>{const t=e.fields.find(e=>"video_url"===e.name);if(t&&t.values){for(let e=0;e<t.values.length;e++){const a=t.values.get(e);a&&"string"===typeof a&&r.push(a)}}}),0===r.length&&e.videoUrl&&(r=[e.videoUrl]),r},[t,e.videoUrl]),[l,i]=(0,p.useState)(o[0]||"");return(0,p.useEffect)(()=>{i(o[0]||"")},[o]),(0,p.useEffect)(()=>{if(!n.current||!l){return;}const e=n.current;let t=null,r=null;return/\.m3u8($|\?)/i.test(l)?u.e(771).then(u.bind(u,771)).then(r=>{const a=r.default;a.isSupported()?(t=new a(),t.loadSource(l),t.attachMedia(e)):e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=l)}):/\.flv($|\?)/i.test(l)||l.startsWith("rtmp")?u.e(341).then(u.t.bind(u,341,23)).then(t=>{const a=t.default;a.isSupported()&&(r=a.createPlayer({type:"flv",url:l}),r.attachMediaElement(e),r.load(),r.play())}):e.src=l,()=>{t&&t.destroy(),r&&r.destroy()}},[l]),c().createElement("div",{style:{width:r,height:a,position:"relative",background:"#000"}},o.length>1&&c().createElement("select",{style:{position:"absolute",zIndex:2,top:10,left:10},value:l,onChange:e=>i(e.target.value)},o.map((e,t)=>c().createElement("option",{value:e,key:e+t},e))),c().createElement("video",{ref:n,style:{width:"100%",height:"100%"},controls:!0,autoPlay:!0}))}).setPanelOptions(e=>e.addTextInput({path:"text",name:"Simple text option",description:"Description of panel option",defaultValue:"Default value of text input option"}).addBooleanSwitch({path:"showSeriesCount",name:"Show series counter",defaultValue:!1}).addRadio({path:"seriesCountSize",defaultValue:"sm",name:"Series counter size",settings:{options:[{value:"sm",label:"Small"},{value:"md",label:"Medium"},{value:"lg",label:"Large"}]},showIf:e=>e.showSeriesCount}).addTextInput({path:"videoUrl",name:"视频流地址",description:"支持 m3u8、flv、rtmp 格式",defaultValue:""}));return s})());
//# sourceMappingURL=module.js.map
